#!/bin/sh
#################################################################
#   )      (\_     # Wolfpack 13.0.0 Build Script               #
#  ((    _/{  "-;  # Created by: Wolfpack Development Team      #
#   )).-" {{ ;"`   # Revised by: Wolfpack Development Team      #
#  ( (  ;._ \\ ctr # Last Modification: check cvs logs          #
#################################################################

# seq replacement (not all distributions include seq)
#wp_seq()
#{
#	FIRST="$1";
#	LAST="$2";
#	while [ "$FIRST" -le "$LAST" ];
#	do
#		echo "$FIRST";
#		FIRST="$(expr $FIRST + 1)";
#	done;
#}

# aszlig: weird, i thought i used seq!?

ask_path()
{
	echo "not found.";
	SUPPLIED_PATH="";
	while ! [ -d "$SUPPLIED_PATH" ];
	do
		echo -en "\nor just press enter to skip.";
		echo -en "\e[A\rPlease enter the correct include directory: ";
		read SUPPLIED_PATH;
		if [ ! "$SUPPLIED_PATH" = "" ]; then
			break;
		fi
	done;
}

if [ "$" != "--enable-debug" ]
then
	echo "Debug: Yes";
	DEBUGOPTS="-g -D_DEBUG"
fi;

if [ "$1" != "--disable-mysql" ]
then
	# <mysql>
	echo -n "Searching for MySQL includes... ";

	MYSQLINC=$(mysql_config --include|cut -d'-' -d'I' -f2);

	if ! [ "$MYSQLINC" ];
	then
		ask_path;
		MYSQLINC="$SUPPLIED_PATH";
		if [ ! "$MYSQLINC" ]; then
			echo "MySQL support disabled ";
		fi
	else
		echo " ( $MYSQLINC )";
	fi;
	# </mysql>
fi;

# <python>
echo -n "Searching for Python includes... ";

for py_incpath in \
	/usr/include/[Pp]ython*/Python.h \
	/usr/local/include/[Pp]ython*/Python.h \
	;
do
	if [ -e "$py_incpath" ];
	then
		py_pathes="$py_pathes\n$py_incpath";
	fi;
done;

PYTHONINC="$(echo -e "$py_pathes"|sort -nr|head -1|sed -e 's/^\(\([^\/]*\/\)*\).*$/\1/;s/\/\+$//')";

if ! [ "$PYTHONINC" ];
then
	ask_path;
	PYTHONINC="$SUPPLIED_PATH";
else
	echo "( $PYTHONINC )";
fi;

echo -n "Searching for Python library.... ";

for py_libpath in \
		/usr/lib/libpython*.so \
		/usr/lib/[Pp]ython*/libpython*.so \
		/usr/lib/[Pp]ython*/config/libpython*.so \
		;
do
	if [ -e "$py_libpath" ];
	then
		py_libs="$py_libs\n$py_libpath";
	fi;
done;

PYTHONLIB="$(echo -e "$py_libs"|sort -nr|head -1|sed -e 's/^\(\([^\/]*\/\)*\).*$/\1/;s/\/\+$//')";

if ! [ "PYTHONLIB" ];
then
	echo -n "Not found :((";
else
	echo "( $PYTHONLIB )";
fi;
# </python>

export MYSQLINC PYTHONINC PYTHONLIB DEBUGOPTS

echo -n "Creating Makefile using qmake... "

if [ -x "$QTDIR/bin/qmake" ];
then
	$QTDIR/bin/qmake -o Makefile wolfpack.pro > /dev/null 2>&1;
else
	qmake -o Makefile wolfpack.pro > /dev/null 2>&1;
fi;

echo "done.";

echo "Configure finished. Please run make now.";
